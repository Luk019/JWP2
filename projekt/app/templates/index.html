{% extends 'base.html' %}

{% block content %}
    <h1>Posts</h1>
    {% for post in posts %}
        {% if not post.is_hidden %}
            <div class="post">
                <h2>{{ post.title }}</h2>
                <p>{{ post.content }}</p>
                <a href="{{ url_for('main.post', post_id=post.id) }}">Comments</a>
                <div>
                    {% set upvotes = post.likes|selectattr('upvote')|list|length %}
                    {% set downvotes = post.likes|rejectattr('upvote')|list|length %}
                    <a href="{{ url_for('main.like_action', entity_id=post.id, entity_type='post', action='upvote') }}" class="{{ 'selected' if post.likes|selectattr('user_id', 'equalto', current_user.id)|selectattr('upvote')|list|length > 0 else '' }}">👍 {{ upvotes }}</a>
                    <a href="{{ url_for('main.like_action', entity_id=post.id, entity_type='post', action='downvote') }}" class="{{ 'selected' if post.likes|selectattr('user_id', 'equalto', current_user.id)|rejectattr('upvote')|list|length > 0 else '' }}">👎 {{ downvotes }}</a>
                    {% if current_user.is_authenticated and (current_user.id == post.user_id or current_user.is_admin) %}
                        <a href="{{ url_for('main.edit_post', post_id=post.id) }}">
                            <img src="{{ url_for('static', filename='img/edit.png') }}" alt="Edit" style="width:20px; height:20px;">
                        </a>
                        <form action="{{ url_for('main.delete_post', post_id=post.id) }}" method="POST" style="display:inline;">
                            <button type="submit" style="border:none; background:none; cursor:pointer;">
                                <img src="{{ url_for('static', filename='img/delete.png') }}" alt="Delete" style="width:20px; height:20px;">
                            </button>
                        </form>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    {% endfor %}
{% endblock %}
